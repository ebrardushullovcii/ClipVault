# Cursor Rules for ClipVault

You are working on ClipVault, a Windows game clipping software in C#/.NET 8.

## Tech Stack

- Windows.Graphics.Capture API + DXGI Desktop Duplication for screen capture
- NAudio 2.2+ with WASAPI for audio
- FFmpeg.AutoGen with NVENC for encoding
- Vortice.Direct3D11/DXGI for DirectX interop

## Code Style

- File-scoped namespaces
- Records for immutable data
- Required properties for mandatory fields
- Private fields: \_camelCase
- Always async/await for I/O
- Implement IDisposable for unmanaged resources

## Key Rules

1. Keep ClipVault.Core free of UI dependencies
2. All capture implementations must implement IScreenCapture
3. Copy audio buffers immediately in event handlers (they're reused!)
4. Use GPU memory for frames until encoding
5. No injection/hooking (anti-cheat compatibility)

## Critical Technical Notes

### Screen Capture

- Use Direct3D11CaptureFramePool.CreateFreeThreaded() for 60fps
- MinUpdateInterval must be >= 1ms
- DXGI Desktop Duplication is fallback for anti-cheat

### NVENC

- P7 preset for quality
- CQP 22 rate control
- Low-latency: delay=0, zerolatency=1, gop_size=1

### Audio

- 48kHz stereo float32
- COPY BUFFERS IMMEDIATELY in DataAvailable handlers

## Project Structure

```
src/ClipVault.Core/     - Core library
src/ClipVault.Service/  - Background service
config/                 - JSON configuration
docs/                   - Documentation
```

## See Also

- docs/PLAN.md for implementation details
- docs/CONVENTIONS.md for full code style guide
- AGENTS.md for comprehensive AI instructions
